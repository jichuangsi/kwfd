<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>课程中心-直播间</title>
    <link rel="stylesheet" href="assets/style/index.css">
    <link rel="stylesheet" href="assets/style/watch.css">
    <link rel="stylesheet" href="assets/style/font_ozia9vubkwb/iconfont.css">
    <link rel="stylesheet" href="assets/style/white-web-sdk.css">
    <script src="AgoraRTCSDK-2.7.0.js"></script>
    <script src="agora-rtm-sdk-0.9.1.js"></script>
    <script src="vendor/jquery.js"></script>
    <script src="vendor/white-web-sdk.js"></script>
    <script src="vendor/index.js"></script>
</head>

<body onunload="leave()">
        <div class="logo fl"><img src="./assets/images/logo.png" alt=""></div>

    <!--style>
    .video__box{width:910px; margin:0 auto; overflow:hidden;}
    .video__main{ width:810px; height:607px;float:left }
    .video__list{ width:200px; height:607px; float:left;}
    .video__item{ width:200px; height:174px; hei background:url(/img/icon_live.png) center center no-repeat; }
    </style>
    <div class="video__main">
    </div>
    <div class="video__list">
        <div class="video__item"></div>
        <div id="video" class="video__item">
            <div id="agora_local"></div>
        </div>
    </div-->

    <div class="box">
            <div class="left_box" id="whiteboard">

            </div>
            <div class="right_box">
                <div id="video" onmousemove="videofocus()" onmouseout="videoblur()">
                    <div class="title">主播正在路上...</div>
                    <div id="agora_local" style="width:100%;height:100%;display:inline-block;"></div>
                    <div class="UserCount">
                        在线人数：<span>0</span>人
                        <i></i>
                        <ul>
                            <li></li>
                        </ul>
                    </div>
                    <div class="nav">
                        <div>
                            <span class="s1" onclick="leave()"></span>
                            <span class="s2" onclick="CameraStop()"></span>
                            <span class="s3" onclick="MicrophoneStop()"></span>
                            <span class="s4" onclick="share()"></span>
                            <!-- <span class="s5" onclick="Same()"></span> -->
                            <span class="s6" onclick="Rotate()"></span>
                        </div>
                    </div>
                </div>
                <div class="text">
                    <div class="nav">
                        <div class="check" onclick = "switchDiv(this)">群聊</div>
                        <div onclick = "switchDiv(this)">用户列表</div>
                    </div>
                    <div class="userList">

                    </div>
                    <div class="message">
                        
                    </div>
                    <div class="Onemessage">
                        
                    </div>
                    <div class="only"></div>
                    <div class="sendbox">
                        <input type="text" class="allipt" onkeyup = "sendkey(event)"><button onclick="send()">发送</button>
                    </div>
                </div>
            </div>
            <div class="baiban_nav">
                <div onclick="check('选择')"><span class="iconfont icon-xuanze"></span></div>
                <div onclick="check('铅笔')"><span class="iconfont icon-pan_icon"></span></div>
                <div onclick="check('矩形')"><span class="iconfont icon-juxingxuanze"></span></div>
                <div onclick="check('椭圆')"><span class="iconfont icon-tuoyuanxing"></span></span></div>
                <div onclick="check('橡皮')"><span class="iconfont icon-xiangpi"></span></div>
                <div onclick="check('文字')"><span class="iconfont icon-wenzi"></span></div>
                <div onclick="check('添加')"><span class="iconfont icon-tianjia"></span></div>
            </div>
            <div class="tab">
                <div class="button" onclick="tab_check('左')"><span class="iconfont icon-zuo"></span></div>
                <div class="ys">
                    <div class="tab_check" onclick="tab_switch(this)">1</div>
                </div>
                <div class="button" onclick="tab_check('右')"><span class="iconfont icon-you"></span></div>
            </div>
    </div>


    <script language="javascript">
        if (!AgoraRTC.checkSystemRequirements()) {
            alert("Your browser does not support WebRTC!");
        }
        /* select Log type */
        // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.NONE);
        // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.ERROR);
        // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.WARNING);
        // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.INFO);  
        // AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.DEBUG);

        /* simulated data to proof setLogLevel() */
        AgoraRTC.Logger.error('this is error');
        AgoraRTC.Logger.warning('this is warning');
        AgoraRTC.Logger.info('this is info');
        AgoraRTC.Logger.debug('this is debug');
        var client, localStream, camera, microphone;
        var chat,channel_room,userId,studentId;
        var userList = []
        var Camera = 1
        var Microphone = 1
        var rotate = 0
        var shareState = 0
        var leaveState = 0
        var localStreams = [];
        var messagestate = 1
        var blockstate = 0
        var Again = 0
        var demo
        var audioSelect = sessionStorage.getItem('audioSelect')
        var videoSelect = sessionStorage.getItem('videoSelect')
        var uid = sessionStorage.getItem('uid');
    	var uname = sessionStorage.getItem('uname');
        var role = sessionStorage.getItem('role')
        var room = sessionStorage.getItem('room')
        var appid = sessionStorage.getItem('appid')
        var roomstate   
        if(role == '2'){
            $('.s2').remove()
            $('.s3').remove()
            $('.s4').remove()
            $('.s5').remove()
            $('.UserCount').remove()
            $('.nav>div').eq(2).remove()
        }else{
            $('.title').remove()
        }
        function join() {
            var channel_key = null;

            client = AgoraRTC.createClient({
                mode: 'live'
            });
            client.init(appid, function () {
                console.log("AgoraRTC client initialized");
                client.join(channel_key, room, null, function (uid) {
                    console.log("User " + uid + " join channel successfully");

                        camera = videoSelect;
                        microphone = audioSelect;
                        localStream = AgoraRTC.createStream({
                            streamID: uid,
                            audio: true,
                            cameraId: camera,
                            microphoneId: microphone,
                            video: true,
                            screen: false
                        });
                        //localStream = AgoraRTC.createStream({streamID: uid, audio: false, cameraId: camera, microphoneId: microphone, video: false, screen: true, extensionId: 'minllpmhdgpndnkomcoccfekfegnlikg'});
                        // if (document.getElementById("video").checked) {
                        localStream.setVideoProfile('480p');//720p_3

                        // }
                        
                    
                        // The user has granted access to the camera and mic.
                        localStream.on("accessAllowed", function () {
                            console.log("accessAllowed");
                        });

                        // if(role == '老师'){
                        // The user has denied access to the camera and mic.
                        localStream.on("accessDenied", function () {
                            console.log("accessDenied");
                        });

                        if(role == '4'){
                        localStream.init(function () {
                            console.log("getUserMedia successfully");
                                localStream.play('agora_local', {fit: "contain"}, function(errState){
                                    if (errState && errState !== "abort"){
                                        // 播放失败，一般为浏览器策略阻止。引导用户用手势触发恢复播放。
                                    }
                                });
                            // if(role == '4'){
                                client.publish(localStream, function (err) {
                                    console.log("Publish local stream error: " + err);
                                });

                                client.on('stream-published', function (evt) {
                                    console.log("Publish local stream successfully");
                                });
                            // }
                            // else{
                            //     localStream.stop('agora_local')
                            // }
                            
                        }, function (err) {
                            console.log("getUserMedia failed", err);
                        });
                        }
                }, function (err) {
                    console.log("Join channel failed", err);
                });
            }, function (err) {
                console.log("AgoraRTC client init failed", err);
            });

            channelKey = "";
            client.on('error', function (err) {
                console.log("Got error msg:", err.reason);
                if (err.reason === 'DYNAMIC_KEY_TIMEOUT') {
                    client.renewChannelKey(channelKey, function () {
                        console.log("Renew channel key successfully");
                    }, function (err) {
                        console.log("Renew channel key failed: ", err);
                    });
                }
            });


            client.on('stream-added', function (evt) {
                var stream = evt.stream;
                console.log("New stream added: " + stream.getId());
                console.log("Subscribe ", stream);
                    client.subscribe(stream, function (err) {
                        console.log("Subscribe stream failed", err);
                    });
                    $('.title')[0].style.display = 'none'
            });

            if(role == '2'){
                client.on('stream-subscribed', function (evt) {
                    var stream = evt.stream;
                    
                    var h = document.body.clientHeight
                    var w = document.body.clientWidth
                    console.log("Subscribe remote stream successfully: " + stream.getId());
                    if ($('div#video #agora_remote' + stream.getId()).length === 0) {
                        $('div#video').append('<div id="agora_remote' + stream.getId() +
                            '" style="position: absolute;right:0px;top:0px;width:100%;height:100%;display:inline-block;"></div>');
                    }
                    // stream.stop('agora_local');
                    stream.play('agora_remote' + stream.getId(), {fit: 'contain'}, function(errState){
                        if (errState && errState !== "abort"){
                            // 播放失败，一般为浏览器策略阻止。引导用户用手势触发恢复播放。
                        }
                    });
                    sessionStorage.setItem('streamId','agora_remote' + stream.getId())
                    if(shareState == 1){
                        shareState=0
                    }
                    if(Again > 0){
                        demo = $('#'+sessionStorage.getItem('streamId'))[0]
                        demo.style.zIndex = '9999'
                        demo.style.width = w-320+'px'
                        demo.style.height = h+'px'
                        demo.style.right = '100%'
                    }
                    shareState++
                    Again++
                    $.post("/index.php?s=/live/index/statistics",{room:room,action:'JOIN',uid:uid,uname:uname,isteacher:0},function(result){
                                    console.log(result);
                    });
                });
            }else {
                    $.post("/index.php?s=/live/index/statistics",{room:room,action:'JOIN',uid:uid,uname:uname,isteacher:1},function(result){
                                    console.log(result);
                    });
                    
                    $.post("/index.php?s=/live/index/statistics",{room:room,action:'QUERY',uid:uid,uname:uname,isteacher:1},function(result){
                        console.log(result);
                        if(result){
                        	$('.UserCount').find('span').text(result.total)
                            var num = 0
                            for(let i = 0; i < result.ids.length; i++) {
                                num++
                                var li = document.createElement('li')
                                li.text = num + result.ids
                                $('.UserCount').find('ul').append(li)
                            }
                        }                        
                });
                setInterval(function(){
                    $.post("/index.php?s=/live/index/statistics",{room:room,action:'QUERY',uid:uid,uname:uname,isteacher:1},function(result){
                        console.log(result);
                        if(result){
                        	$('.UserCount').find('span').text(result.total)
                            var num = 0;
                            for(let i = 0;i<result.ids.length;i++){
                                num++;
                                var li = document.createElement('li')
                                li.text = num + result.ids
                                $('.UserCount').find('ul').append(li)
                            }
                        }                        
                });
                },30000)
            }

            client.on('stream-removed', function (evt) {
                var stream = evt.stream;
                stream.stop();
                $('#agora_remote' + stream.getId()).remove();
                console.log("Remote stream is removed " + stream.getId());
                demo.style.zIndex = '1'
                demo.style.width = '100%'
                demo.style.height = '100%'
            });

            client.on("peer-online", function(evt) {
            	console.log("peer-online", evt.uid);
            }); 
            
            client.on('peer-leave', function (evt) {
                var stream = evt.stream;
                if (stream) {
                    stream.stop();
                    $('#agora_remote' + stream.getId()).remove();
                    console.log(evt.uid + " leaved from this channel");
                    $('.title')[0].style.display = 'block'
                }
            });
            // 群聊
            chat = AgoraRTM.createInstance(appid)
            userId = Math.floor(Math.random()*100+1)+'s'
            userId = uid + '_' + userId;
            console.log(userId)
            sessionStorage.setItem('userId',userId)
            channel_room = chat.createChannel(room)
            chat.login({ token: null, uid: userId }).then(() => {
                console.log('AgoraRTM client login success');
                channel_room.join().then(() => {
                    /* 加入频道成功的处理逻辑 */
                    channel_room.getMembers().then(membersList => { // membersList 为获取到的频道成员列表
                    /* 获取频道成员列表成功的处理逻辑 */
                    userList.push(...membersList)
                    for(let i = 0;i<userList.length;i++){
                        if(role == '4'&&userList[i]==userId){
                            userList.splice(i,1)
                        }
                    }
                    
                    var arr = userList
                    $('.userList').children().remove()
                    for(let i = 0;i<arr.length;i++){
                                var div = document.createElement('div')
                                div.innerHTML = '<div onclick="Popup(this)">'+arr[i]+'</div>'
                                console.log($('.userList'))
                                $('.userList').append(div)
                                var div = document.createElement('div')
                                div.className = 'Popupbox'
                                div.innerHTML = '<div class="onlymessage" data-id="'+arr[i]+'"></div>'
                                $('.only').append(div)
                            }
                    }).catch(error => {
                    /* 频道消息发送失败的处理逻辑 */
                    });
                    }).catch(error => {
                    /* 加入频道失败的处理逻辑 */
                })
                }).catch(err => {
                console.log('AgoraRTM client login failure', err);
            });
            channel_room.on('ChannelMessage', ({ text }, senderId) => { // text 为收到的频道消息文本，senderId 为发送方的 User ID
            /* 收到频道消息的处理逻辑 */
                console.log(text)
                var div = document.createElement('div')
                div.className = 'clearfix'
                div.innerHTML = '<span class="fl" style="margin-left: 10px;">'+senderId+'</span><span class="fl">'+text+'<em></em></span>'
                $('.message').append(div)
            });
            channel_room.on('MemberJoined', memberId => { // memberId 为加入频道的用户 ID
            /* 收到频道用户加入通知的处理逻辑 */
            console.log(1111111111)
                userList.push(memberId)
                $('.userList').children().remove()
                for(let i = 0;i<userList.length;i++){
                        var div = document.createElement('div')
                        div.innerHTML = '<div onclick="Popup(this)">'+userList[i]+'</div>'
                        $('.userList').append(div)
                    }
                        var div = document.createElement('div')
                        div.className = 'Popupbox'
                        div.innerHTML = '<div class="onlymessage" data-id="'+memberId+'"></div>'
                        $('.only').append(div)
                        
            })
            channel_room.on('MemberLeft', memberId => { // memberId 为离开频道的用户 ID
            console.log(22222222222)
            /* 收到频道用户离开通知的处理逻辑 */
            for(let i = 0;i<userList.length;i++){
                if(userList[i] == memberId){
                    userList.splice(i,1)
                }
            }
            var arr = userList
            $('.userList').children().remove()
            for(let i = 0;i<arr.length;i++){
                        var div = document.createElement('div')
                        div.innerHTML = '<div onclick="Popup(this)">'+arr[i]+'</div>'
                        $('.userList').append(div)
                    }
            for(var q = 0; q < $('.onlymessage').length;q++){
                        if($($('.onlymessage')[q]).attr('data-id') == memberId){
                            $($('.onlymessage')[q]).parent().remove()
                        }
                    }
            for(var e = 0; e < $('.text>.nav>div').length;e++){
                        if($($('.text>.nav>div')[e]).text() == memberId){
                            $($('.text>.nav>div')[e]).remove()
                        }
                    }        
            })
            chat.on('MessageFromPeer', ({ text }, peerId) => { // text 为消息文本，peerId 是消息发送方 User ID
            /* 收到点对点消息的处理逻辑 */
                if(role == '2'){
                    if(messagestate == 1){
                        var div = '<div onclick = "switchDiv(this)">'+peerId+'<i></i></div>'
                        $('.text>.nav').append(div)
                        messagestate++
                    }else {
                        var i = document.createElement('i')
                        $('.text>.nav>div').eq(1).append(i)
                    }
                    var div = document.createElement('div')
                    div.className = 'clearfix'
                    div.innerHTML = '<span class="fl" style="margin-left: 10px;">'+peerId+'</span><span class="fl">'+text+'<em></em></span>'
                    $('.Onemessage').append(div)
                }else{
                    // var num = '.'+peerId
                    // var i = document.createElement('i')
                    // $('.nav>div').eq(2).append(i)
                    $('.userList>div').eq(userList.indexOf(peerId)).find('div').append(i)
                    var div = document.createElement('div')
                    div.className = 'clearfix'
                    div.innerHTML = '<span class="fl" style="margin-left: 10px;">'+peerId+'</span><span class="fl">'+text+'<em></em></span>'
                    $('.Popupbox').eq(userList.indexOf(peerId)).find('.onlymessage').append(div)
                }
            });
        }

        function leave() {  
            if(leaveState == 0){
                if(role == '2'){
                    $.post("/index.php?s=/live/index/statistics",{room:room,action:'LEAVE',uid:uid,uname:uname,isteacher:0},function(result){
                                    console.log(result);
                    });
                }else{
                    $.post("/index.php?s=/live/index/statistics",{room:room,action:'LEAVE',uid:uid,uname:uname,isteacher:1},function(result){
                                    console.log(result);
                    });
                }
                client.leave(function () {
                    console.log("Leavel channel successfully");
                    leaveState++
                }, function (err) {
                    console.log("Leave channel failed");
                });
                channel_room.leave()
            }
            //聊天室登出
            chat.logout();
            //共享白板登出
            baibanLeave()
        }
        function CameraStop(){
                if(Camera == 1){
                    Camera = 2
                    localStream.muteVideo();
                    $('.s2')[0].style.backgroundPosition = '-35px -108px'
                }else {
                    Camera = 1
                    localStream.unmuteVideo();
                    $('.s2')[0].style.backgroundPosition = '-167px -108px'
                }
        }
        function MicrophoneStop(){
            if(Microphone == 1){
                    Microphone = 2
                    localStream.muteAudio();
                    $('.s3')[0].style.backgroundPosition = '-36px -189px'
                }else {
                    Microphone = 1
                    localStream.unmuteAudio();
                    $('.s3')[0].style.backgroundPosition = '-169px -189px'
                }
        }
        function videofocus(){
            $('.nav')[0].style.bottom = '0px'
        }
        function videoblur(){
            $('.nav')[0].style.bottom = '-60px'
        }
        function Rotate (){
            rotate -= 90
            $('#video').find('video')[0].style.transform = "rotate("+rotate+"deg) rotateY(180deg)"
        }


        //audioSelect.onchange = getDevices;
        //videoSelect.onchange = getDevices;
        join();


        function share(){
         var channel_key = null;
         var screenClient = AgoraRTC.createClient({mode: 'live'});
         screenClient.init(appid, function() {
          screenClient.join(channel_key, room, null, function(uid) {
          // 保存本地流的uid
          localStreams.push(uid);
          // 创建屏幕共享流
          /* Number.tem = ua.match(/(Chrome(?=\/))\/?(\d+)/i);
          if(parseInt(tem[2]) >= 72  && navigator.mediaDevices.getDisplayMedia ) {
           // Create the stream for screensharing
              screenStream = AgoraRTC.createStream({
                  streamID: uid,
                  audio: false,
                  video: false,
                  screen: true,
               // Firefox
                  mediaSource: 'window' // 'screen', 'application', 'window'
              });

          }else{ */
           screenStream = AgoraRTC.createStream({
               streamID: uid,
               audio: false, // 设置屏幕共享不带音频，避免订阅端收到的两路流中都有音频，导致回声
               video: false,
               screen: true,
               // Chrome
               //extensionId: 'minllpmhdgpndnkomcoccfekfegnlikg',
               // Firefox
               mediaSource: 'window' // 'screen', 'application', 'window'
              });
          screenStream.setScreenProfile('480p_2');
          //}          
          // 初始化流
          screenStream.init(function() {
           // 播放流
           //screenStream.play('Screen');
           // 推流
            /* AgoraRTC.getScreenSources(function(err, sources) {
                console.log(sources)
            }) */
            //debugger;
           screenClient.publish(screenStream);

           // 监听流（用户）加入频道事件
           screenClient.on('stream-added', function(evt) {
            var stream = evt.stream;
            var uid = stream.getId();

            // 收到流加入频道的事件后，先判定是不是本地的uid
            if(!localStreams.includes(uid)) {
              console.log('subscribe stream:' + uid);
              // 拉流
              screenClient.subscribe(stream);
            }
           })
          }, function (err) {
            console.log(err);
          });
         }, function (err) {
           console.log(err);
         })
         })
        }
        function send(){
            var message = $('.allipt').val()
            if($('.check').text() == '群聊'&&message!=''){
                channel_room.sendMessage({ text: message }).then(() => {
                /* 频道消息发送成功的处理逻辑 */
                console.log(message)
                var div = document.createElement('div')
                div.className = 'clearfix'
                div.innerHTML = '<span class="fr">'+userId+'</span><span class="fr">'+message+'<i></i></span>'
                $('.message').append(div)
                $('.allipt').val("")
                }).catch(error => {
                /* 频道消息发送失败的处理逻辑 */
                });
            }else if($('.check').text() != '群聊'&&message!=''){
                var messageId
                if(role == '2'){
                    messageId =  $('.nav>div').eq(2).text()
                }else{
                    messageId = studentId
                }
                chat.sendMessageToPeer(
                    { text: message }, // 符合 RtmMessage 接口的参数对象
                    messageId, // 远端用户 ID
                ).then(sendResult => {
                var div = document.createElement('div')
                div.className = 'clearfix'
                div.innerHTML = '<span class="fr">'+userId+'</span><span class="fr">'+message+'<i></i></span>'
                if(role == '2'){
                    $('.Onemessage').append(div)
                    $('.allipt').val("")
                }else{
                    $('.allipt').val("")
                    // $('.onlymessage').append(div)+
                    for(var i = 0; i < $('.onlymessage').length;i++){
                        if($($('.onlymessage')[i]).attr('data-id') == studentId){
                            $($('.onlymessage')[i]).append(div)
                        }
                    }
                }
                if (sendResult.hasPeerReceived) {
                    /* 远端用户收到消息的处理逻辑 */
                } else {
                    /* 服务器已接收、但远端用户不可达的处理逻辑 */
                }
                }).catch(error => {
                /* 发送失败的处理逻辑 */
                });
            }
        }
        function switchDiv(e){
            $(e).addClass('check').siblings().removeClass('check')
            console.log(e)
            if($(e).text() == '群聊'){
                $('.message')[0].style.zIndex = '10'
                $('.userList')[0].style.zIndex = '0'
                $('.Onemessage')[0].style.zIndex = '0'
                $('.only')[0].style.zIndex = '0'
            }else if($(e).text() == '用户列表'){
                $('.userList')[0].style.zIndex = '12'
                $('.message')[0].style.zIndex = '0'
                $('.Onemessage')[0].style.zIndex = '0'
                $('.only')[0].style.zIndex = '0'
                $('.nav>div').eq(2).find('i').remove()
            }else if($(e).text() != '用户列表'&&$(e).text() != '群聊'){
                if(role == '2'){
                    $('.Onemessage')[0].style.zIndex = '10'
                }else{
                    studentId = $(e).text()
                    $('.only')[0].style.zIndex = '10'
                    $('.Popupbox').removeClass('Popup_z')
                    for(var i = 0; i < $('.onlymessage').length;i++){
                        if($($('.onlymessage')[i]).attr('data-id') == $(e).text()){
                            $($('.onlymessage')[i]).parent().addClass('Popup_z')
                        }
                    }
                }
                $('.message')[0].style.zIndex = '0'
                $('.userList')[0].style.zIndex = '0'
                $('.nav>div').eq(2).find('i').remove()
            }
        }
        function sendkey(event){
            if(event.keyCode == 13){
                send()
            }
        }
        function Popup(val){
            console.log(studentId)
            var studentIdnow
            console.log($('.text>.nav>div').text())
            console.log($('.text>.nav>div').text().indexOf(studentId)==-1)
            if(studentId == null){
                var div = '<div onclick = "switchDiv(this)">'+$(val).text()+'</div>'
                $('.text>.nav').append(div)
                var div = document.createElement('div')
            }else if(studentId!=studentIdnow){
                var div = '<div onclick = "switchDiv(this)">'+$(val).text()+'</div>'
                $('.text>.nav').append(div)
                var div = document.createElement('div')
            }
            if($('.text>.nav>div').text().indexOf(studentId)==-1){
                console.log(111111111111)
            }
            studentId = $(val).text()
                console.log(2222222222)
            $('.userList')[0].style.zIndex = '0'
            $(val).find('i').remove()
            for(var j = 0; j < $('.text>.nav>div').length;j++){
                if($($('.text>.nav>div')[j]).text() == studentId){
                    $($('.text>.nav>div')[j]).addClass('check').siblings().removeClass('check')
                }
            }
            // if(userList.indexOf(studentId)!=-1){
            //     $('.Popupbox').removeClass('Popup_z')
            //     if($('.onlymessage').attr('data-id') == studentId){
            //         console.log($('.onlymessage').parent()[0])
            //     }
            // }else{
            //     $('.Popupbox').removeClass('Popup_z')
                
            // }
            $('.Popupbox').removeClass('Popup_z')
            for(var i = 0; i < $('.onlymessage').length;i++){
                if($($('.onlymessage')[i]).attr('data-id') == studentId){
                    $($('.onlymessage')[i]).parent().addClass('Popup_z')
                }
            }
        }
        function Popupout(){
            $('.only')[0].style.width = '0px'
            $('.only')[0].style.height = '0px'
        }

        
        // 
        // $('.text>.nav>div').on('mouseover',function(){
        //     var span = document.createElement('span')
        //     span.innerText = this.innerText
        //     $(this).append(span)
        // })
        // $('.text>.nav>div').on('mouseout',function(){
        //     $(this).find('span').remove()
        // })
        onresize = function () {
            // alert(document.body.clientHeight)
            console.log(document.body.clientHeight)
            h = document.body.clientHeight
            w = document.body.clientWidth
                if(Again > 0){
                demo = $('#'+sessionStorage.getItem('streamId'))[0]
                demo.style.zIndex = '9999'
                demo.style.width = w-320+'px'
                demo.style.height = h+'px'
                demo.style.right = '100%'
                }
            $('#whiteboard').text(h)
            $('#whiteboard')[0].style.height = h + 'px'
            $('.box')[0].style.height = h + 'px'
            if(Number(h) < 500) {
                $('.text').addClass('text_small')
                console.log($('.baiban_nav>div').eq(7)[0])
                if(!$('.baiban_nav>div').eq(7)[0]){
                    $('.baiban_nav').append('<div onclick="block()"><span class="iconfont icon-xinxihuihuaxiaoxi"></span></div>')
                }
            }else{
                $('.text').removeClass('text_small')
                $('.baiban_nav>div').eq(7).remove()
                $('.text')[0].style.height = h-240 + 'px'
                $('.nav')[0].style.height = h-240 + 'px'
                $('.userList')[0].style.height = h-240-36 + 'px'
                $('.message')[0].style.height = h-240-36-36 + 'px'
                $('.Onemessage')[0].style.height = h-240-36-36 + 'px'
                $('.only')[0].style.height = h-240-36-36 + 'px'
            }
        }
        $(function(){
            h = document.body.clientHeight
            $('.text')[0].style.height = h-240 + 'px'
            $('.nav')[0].style.height = h-240 + 'px'
            $('.userList')[0].style.height = h-240-36 + 'px'
            $('.message')[0].style.height = h-240-36-36 + 'px'
            $('.Onemessage')[0].style.height = h-240-36-36 + 'px'
            $('.only')[0].style.height = h-240-36-36 + 'px'
            if(h < 500) {
                $('.text').addClass('text_small')
                if(!$('.baiban_nav>div').eq(7)[0]){
                    $('.baiban_nav').append('<div onclick="block()"><span class="iconfont icon-xinxihuihuaxiaoxi"></span></div>')
                }
            }
        })
        function block(){
            h = document.body.clientHeight
            $('.text')[0].style.height = h + 'px'
            $('.nav')[0].style.height = h + 'px'
            $('.userList')[0].style.height = h-36 + 'px'
            $('.message')[0].style.height = h-36-36 + 'px'
            $('.Onemessage')[0].style.height = h-36-36 + 'px'
            $('.only')[0].style.height = h-36-36 + 'px'
            if(blockstate == 0){
                $('.text_small')[0].style.display = 'block'
                blockstate++
            }else{
                $('.text_small')[0].style.display = 'none'
                blockstate--
            }
        }


    </script>
</body>

</html>